
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Â§ßÊàê„Ç∏„É•„Éã„Ç¢„Éê„É¨„Éº„Éú„Éº„É´„ÇØ„É©„Éñ „ÇØ„É™„Çπ„Éû„Çπ‰ºö</title>
    <!-- „Çπ„Çø„Ç§„É´„Å®Â§ñÈÉ®„É©„Ç§„Éñ„É©„É™ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;700&display=swap" rel="stylesheet">
    <!-- Babel (JSX„Çí„Éñ„É©„Ç¶„Ç∂„ÅßÂãï„Åã„Åô„Åü„ÇÅ) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        body {
            font-family: 'M PLUS Rounded 1c', sans-serif;
            background-color: #f8fafc;
        }
        .christmas-gradient {
            background: linear-gradient(135deg, #b91c1c 0%, #15803d 100%);
        }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        @keyframes spin-slow {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .animate-spin-slow { animation: spin-slow 12s linear infinite; }
    </style>

    <!-- „É©„Ç§„Éñ„É©„É™„ÅÆ„Ç§„É≥„Éù„Éº„ÉàË®≠ÂÆö -->
    <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@19.0.0",
    "react-dom/client": "https://esm.sh/react-dom@19.0.0/client",
    "recharts": "https://esm.sh/recharts@2.15.0",
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/",
    "react/": "https://esm.sh/react@^19.2.3/"
  }
}
</script>
</head>
<body>
    <div id="root"></div>

    <!-- „Åì„Åì„Å´ÂÖ®„Å¶„ÅÆ„Éó„É≠„Ç∞„É©„É†„ÇíÊõ∏„Åç„Åæ„Åô -->
    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useMemo } from 'react';
        import ReactDOM from 'react-dom/client';
        import { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, Cell } from 'recharts';

        // --- Ë®≠ÂÆö (Constants) ---
        const TEAMS = [
            { id: 'team-red', name: 'Ëµ§„ÉÅ„Éº„É†', color: 'bg-red-500', hex: '#ef4444' },
            { id: 'team-blue', name: 'Èùí„ÉÅ„Éº„É†', color: 'bg-blue-500', hex: '#3b82f6' },
            { id: 'team-yellow', name: 'ÈªÑ„ÉÅ„Éº„É†', name_display: 'ÈªÑ„ÉÅ„Éº„É†', color: 'bg-yellow-400', hex: '#facc15' },
            { id: 'team-green', name: 'Á∑ë„ÉÅ„Éº„É†', color: 'bg-green-500', hex: '#22c55e' },
        ];

        const GAMES = [
            { id: 'game-dengon', name: '‰ºùË®Ä„Ç≤„Éº„É†', description: 'ÂêÑÂïè„Åî„Å®„Å´È†Ü‰Ωç„ÅßÂæóÁÇπ„ÅåÂÖ•„Çä„Åæ„Åô„ÄÇ', icon: 'üó£Ô∏è', rounds: 5, scoringType: 'ranking-30' },
            { id: 'game-visual', name: 'Âãï‰ΩìË¶ñÂäõ„Ç≤„Éº„É†', description: 'ÂêÑÂïè„Åî„Å®„Å´È†Ü‰Ωç„ÅßÂæóÁÇπ„ÅåÂÖ•„Çä„Åæ„Åô„ÄÇ', icon: 'üëÅÔ∏è', rounds: 5, scoringType: 'ranking-30' },
            { id: 'game-gesture', name: '„Ç∏„Çß„Çπ„ÉÅ„É£„Éº', description: 'Ê≠£Ëß£„Åô„Çã„Åî„Å®„Å´10ÁÇπ„ÄÇ', icon: 'üé≠', rounds: 6, scoringType: 'success-10' },
            { id: 'game-relay', name: '„É™„É¨„Éº', description: 'ÂêÑ„É¨„Éº„Çπ„ÅÆÈ†Ü‰Ωç„ÅßÂæóÁÇπ„ÅåÂÖ•„Çä„Åæ„Åô„ÄÇ', icon: 'üèÉ', rounds: 2, scoringType: 'ranking-40' },
        ];

        // --- „É°„Ç§„É≥„Ç¢„Éó„É™ (App) ---
        const App = () => {
            const [scores, setScores] = useState([]);
            const [activeTab, setActiveTab] = useState('leaderboard');
            const [selectedGameId, setSelectedGameId] = useState(GAMES[0].id);
            const [selectedRound, setSelectedRound] = useState(0);

            useEffect(() => {
                const saved = localStorage.getItem('vball_xmas_v3');
                if (saved) setScores(JSON.parse(saved));
            }, []);

            useEffect(() => {
                localStorage.setItem('vball_xmas_v3', JSON.stringify(scores));
            }, [scores]);

            const rankings = useMemo(() => {
                const teamTotals = TEAMS.map(team => {
                    const total = scores
                        .filter(s => s.teamId === team.id)
                        .reduce((sum, s) => sum + s.points, 0);
                    return { teamId: team.id, teamName: team.name, totalScore: total };
                });
                return teamTotals
                    .sort((a, b) => b.totalScore - a.totalScore)
                    .map((t, index) => ({ ...t, rank: index + 1 }));
            }, [scores]);

            const handleUpdateScore = (teamId, gameId, roundIndex, points) => {
                setScores(prev => {
                    const otherScores = prev.filter(s => !(s.teamId === teamId && s.gameId === gameId && s.roundIndex === roundIndex));
                    return [...otherScores, { teamId, gameId, roundIndex, points }];
                });
            };

            const resetAllScores = () => {
                if (window.confirm("ÂÖ®„Å¶„ÅÆÂæóÁÇπ„Çí„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åô„ÅãÔºü")) {
                    setScores([]);
                    localStorage.removeItem('vball_xmas_v3');
                }
            };

            const currentGame = GAMES.find(g => g.id === selectedGameId);

            const renderScoringControls = (teamId, game, roundIdx) => {
                const currentScore = scores.find(s => s.teamId === teamId && s.gameId === game.id && s.roundIndex === roundIdx);
                const currentPoints = currentScore ? currentScore.points : null;

                if (game.scoringType.startsWith('ranking')) {
                    const is40 = game.scoringType === 'ranking-40';
                    const options = is40 
                        ? [{ l: '1‰Ωç', p: 40, c: 'bg-yellow-400' }, { l: '2‰Ωç', p: 30, c: 'bg-gray-300' }, { l: '3‰Ωç', p: 20, c: 'bg-orange-400' }, { l: '4‰Ωç', p: 10, c: 'bg-gray-100' }]
                        : [{ l: '1‰Ωç', p: 30, c: 'bg-yellow-400' }, { l: '2‰Ωç', p: 20, c: 'bg-gray-300' }, { l: '3‰Ωç', p: 10, c: 'bg-orange-400' }, { l: '4‰Ωç', p: 0, c: 'bg-gray-100' }];
                    
                    return (
                        <div className="flex gap-1">
                            {options.map(opt => (
                                <button
                                    key={opt.l}
                                    onClick={() => handleUpdateScore(teamId, game.id, roundIdx, opt.p)}
                                    className={`px-3 py-2 rounded-lg text-xs font-bold transition-all border ${
                                        currentPoints === opt.p ? `${opt.c} text-white border-transparent shadow-inner` : 'bg-white text-gray-500 border-gray-200'
                                    }`}
                                >
                                    {opt.l}
                                </button>
                            ))}
                        </div>
                    );
                }

                if (game.scoringType === 'success-10') {
                    const isSuccess = currentPoints === 10;
                    return (
                        <button
                            onClick={() => handleUpdateScore(teamId, game.id, roundIdx, isSuccess ? 0 : 10)}
                            className={`px-6 py-2 rounded-full font-bold transition-all border flex items-center gap-2 ${
                                isSuccess ? 'bg-green-500 text-white border-transparent' : 'bg-white text-gray-400 border-gray-200'
                            }`}
                        >
                            <i className={isSuccess ? "fas fa-check-circle" : "far fa-circle"}></i>
                            {isSuccess ? 'Ê≠£Ëß£ÔºÅ' : 'Êú™ÈÅîÊàê'}
                        </button>
                    );
                }
            };

            return (
                <div className="min-h-screen pb-24 bg-gray-50 flex flex-col">
                    <header className="christmas-gradient text-white p-6 shadow-lg relative overflow-hidden">
                        <div className="absolute top-2 right-4 opacity-20 pointer-events-none">
                            <i className="fas fa-snowflake fa-4x animate-spin-slow"></i>
                        </div>
                        <div className="relative z-10">
                            <p className="text-red-100 opacity-90 text-xs font-bold tracking-widest mb-1">Â§ßÊàê„Ç∏„É•„Éã„Ç¢„Éê„É¨„Éº„Éú„Éº„É´„ÇØ„É©„Éñ</p>
                            <h1 className="text-2xl font-black flex items-center gap-2">üéÑ „ÇØ„É™„Çπ„Éû„Çπ‰ºö</h1>
                        </div>
                    </header>

                    <main className="flex-grow p-4 max-w-5xl mx-auto w-full">
                        {activeTab === 'leaderboard' && (
                            <div className="space-y-6">
                                <div className="bg-white rounded-2xl p-6 shadow-sm border-l-8 border-red-600">
                                    <h2 className="text-xl font-bold text-gray-800">üèÜ „É©„É≥„Ç≠„É≥„Ç∞</h2>
                                </div>
                                <div className="bg-white rounded-2xl p-6 shadow-sm border border-gray-100 h-64">
                                    <ResponsiveContainer width="100%" height="100%">
                                        <BarChart data={rankings}>
                                            <CartesianGrid strokeDasharray="3 3" vertical={false} />
                                            <XAxis dataKey="teamName" />
                                            <YAxis />
                                            <Tooltip />
                                            <Bar dataKey="totalScore" radius={[4, 4, 0, 0]}>
                                                {rankings.map((entry, index) => (
                                                    <Cell key={index} fill={TEAMS.find(t => t.id === entry.teamId)?.hex} />
                                                ))}
                                            </Bar>
                                        </BarChart>
                                    </ResponsiveContainer>
                                </div>
                                <div className="grid gap-4 grid-cols-2 lg:grid-cols-4">
                                    {rankings.map((team, idx) => (
                                        <div key={team.teamId} className="bg-white rounded-2xl p-4 shadow-sm border border-gray-100">
                                            <div className="flex items-center justify-between mb-2">
                                                <div className={`w-6 h-6 rounded-full flex items-center justify-center font-bold text-[10px] ${idx === 0 ? 'bg-yellow-400 text-white' : 'bg-gray-100 text-gray-400'}`}>{team.rank}</div>
                                                <div className="text-lg font-black">{team.totalScore}pt</div>
                                            </div>
                                            <h3 className="font-bold text-sm truncate">{team.teamName}</h3>
                                            <div className={`h-1 w-full rounded-full mt-1 ${TEAMS.find(t => t.id === team.teamId)?.color}`}></div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {activeTab === 'input' && (
                            <div className="space-y-6">
                                <div className="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
                                    <div className="p-4 bg-gray-50 border-b flex gap-2 overflow-x-auto scrollbar-hide">
                                        {GAMES.map(game => (
                                            <button key={game.id} onClick={() => {setSelectedGameId(game.id); setSelectedRound(0);}} className={`px-4 py-2 rounded-full text-xs font-bold whitespace-nowrap ${selectedGameId === game.id ? 'bg-green-600 text-white shadow-md' : 'bg-white text-gray-600 border border-gray-200'}`}>
                                                {game.icon} {game.name}
                                            </button>
                                        ))}
                                    </div>
                                    <div className="p-6">
                                        <div className="mb-6 flex flex-col gap-4">
                                            <h2 className="text-xl font-bold flex items-center gap-2">{currentGame.icon} {currentGame.name}</h2>
                                            <div className="flex gap-1 bg-gray-100 p-1 rounded-xl self-start">
                                                {[...Array(currentGame.rounds)].map((_, i) => (
                                                    <button key={i} onClick={() => setSelectedRound(i)} className={`w-10 h-10 rounded-lg text-xs font-bold ${selectedRound === i ? 'bg-white text-green-600 shadow-sm' : 'text-gray-400'}`}>
                                                        {i+1}
                                                    </button>
                                                ))}
                                            </div>
                                        </div>
                                        <div className="space-y-3">
                                            {TEAMS.map(team => (
                                                <div key={team.id} className="p-4 rounded-xl border border-gray-100 bg-gray-50 flex items-center justify-between">
                                                    <span className="font-bold text-sm text-gray-700">{team.name}</span>
                                                    {renderScoringControls(team.id, currentGame, selectedRound)}
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {activeTab === 'admin' && (
                            <div className="bg-white rounded-2xl p-8 shadow-sm border border-gray-100 text-center">
                                <h2 className="text-xl font-bold text-red-600 mb-8">ÁÆ°ÁêÜÁî®</h2>
                                <button onClick={resetAllScores} className="w-full max-w-xs py-4 bg-red-100 text-red-700 font-bold rounded-xl hover:bg-red-200 transition-colors">
                                    <i className="fas fa-trash-alt mr-2"></i> ÂæóÁÇπ„ÇíÂÖ®„Å¶„É™„Çª„ÉÉ„Éà
                                </button>
                            </div>
                        )}
                    </main>

                    <nav className="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 p-3 flex justify-around items-center z-50 shadow-lg">
                        <button onClick={() => setActiveTab('leaderboard')} className={`flex flex-col items-center gap-1 ${activeTab === 'leaderboard' ? 'text-red-600' : 'text-gray-400'}`}>
                            <i className="fas fa-trophy"></i><span className="text-[10px] font-bold">È†Ü‰ΩçË°®</span>
                        </button>
                        <button onClick={() => setActiveTab('input')} className={`flex flex-col items-center gap-1 ${activeTab === 'input' ? 'text-green-600' : 'text-gray-400'}`}>
                            <i className="fas fa-edit"></i><span className="text-[10px] font-bold">ÂÖ•Âäõ</span>
                        </button>
                        <button onClick={() => setActiveTab('admin')} className={`flex flex-col items-center gap-1 ${activeTab === 'admin' ? 'text-gray-800' : 'text-gray-400'}`}>
                            <i className="fas fa-cog"></i><span className="text-[10px] font-bold">Ë®≠ÂÆö</span>
                        </button>
                    </nav>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>